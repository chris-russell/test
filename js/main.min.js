var dragSelected=false,dragFinished=false,isKeyboard=false,dragSelectedId='';function initDrag(){$("#dragReserves,#dragProduction,#dragConsumption").draggable({revert:true,containment:'document',start:function(event,ui){$.fx.off=false;isKeyboard=false;highlightTargets(this.id);clearFocus();},stop:function(event,ui){$(this).css({top:'0em',left:'0em',marginTop:'-0.15em',marginLeft:'-0.15em'});}});$("#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3").droppable({drop:function(event,ui){if(this.children.length===0){$.fx.off=true;$(ui.draggable).detach().appendTo(this).css({top:'0em',left:'0em',marginTop:'-0.15em',marginLeft:'-0.15em'});document.getElementById('feedbackContainer').innerHTML='';dragFinished=true;setTimeout(function(){dragFinished=false;},300);clearSelection();clearFocus();}}});}
function focusStart(ev,obj){if(dragSelected===false&&dragFinished===false){clearSelection();$('#'+obj.id).removeClass('dragMove dragOff').addClass('dragFocused');document.getElementById('in3').setAttribute("role","alert");setTimeout(function(){document.getElementById('in3').removeAttribute("role");},3000);}else if(dragFinished===true){obj.blur();}}
function focusEnd(ev,obj){if(dragSelected===false){clearSelection();}}
function dragClick(ev,obj){if(dragFinished===false){isKeyboard=false;highlightTargets(obj.id);clearFocus();}}
function targetClicked(obj){if(dragSelected===true){isKeyboard=false;obj.appendChild(document.getElementById(dragSelectedId));document.getElementById('feedbackContainer').innerHTML='';clearSelection();clearFocus();}}
function keyDownGlobal(event){var focusId=document.activeElement.id;if(dragSelected===true){if(event.keyCode===10||event.keyCode===13||event.keyCode===32||(event.ctrlKey&&event.keyCode===77)){if(focusId==='equationTop'||focusId==='equationBottom'||focusId==='dragHolder1'||focusId==='dragHolder2'||focusId==='dragHolder3'){isKeyboard=true;document.getElementById(focusId).appendChild(document.getElementById(dragSelectedId));document.getElementById('feedbackContainer').innerHTML='';clearSelection();document.getElementById(dragSelectedId).focus();}}else if(event.keyCode===27){clearSelection();document.getElementById(dragSelectedId).focus();}else if(event.keyCode===37||event.keyCode===38||event.keyCode===39||event.keyCode===40){if(focusId!=='dragHolder3'&&document.getElementById('dragHolder3').children.length===0){document.getElementById('dragHolder3').focus();}
if(focusId!=='dragHolder2'&&document.getElementById('dragHolder2').children.length===0){document.getElementById('dragHolder2').focus();}
if(focusId!=='dragHolder1'&&document.getElementById('dragHolder1').children.length===0){document.getElementById('dragHolder1').focus();}
if(focusId!=='equationBottom'&&document.getElementById('equationBottom').children.length===0){document.getElementById('equationBottom').focus();}
if(focusId!=='equationTop'&&document.getElementById('equationTop').children.length===0){document.getElementById('equationTop').focus();}}}else{if(event.keyCode===10||event.keyCode===13||event.keyCode===32||(event.ctrlKey&&event.keyCode===77)){if(focusId==='dragReserves'||focusId==='dragProduction'||focusId==='dragConsumption'){isKeyboard=true;highlightTargets(focusId);}}else if(event.keyCode===37||event.keyCode===38){if(focusId==='dragReserves'||focusId==='dragProduction'||focusId==='dragConsumption'){if(focusId===document.getElementsByClassName('ui-draggable')[0].id){document.getElementById(document.getElementsByClassName('ui-draggable')[2].id).focus();}else if(focusId===document.getElementsByClassName('ui-draggable')[1].id){document.getElementById(document.getElementsByClassName('ui-draggable')[0].id).focus();}else{document.getElementById(document.getElementsByClassName('ui-draggable')[1].id).focus();}}else if(focusId==="instructions"||focusId==="buttonCheck"){document.getElementById(document.getElementsByClassName('ui-draggable')[2].id).focus();}}else if(event.keyCode===39||event.keyCode===40){if(focusId==='dragReserves'||focusId==='dragProduction'||focusId==='dragConsumption'){if(focusId===document.getElementsByClassName('ui-draggable')[0].id){document.getElementById(document.getElementsByClassName('ui-draggable')[1].id).focus();}else if(focusId===document.getElementsByClassName('ui-draggable')[1].id){document.getElementById(document.getElementsByClassName('ui-draggable')[2].id).focus();}else{document.getElementById(document.getElementsByClassName('ui-draggable')[0].id).focus();}}else if(focusId==="instructions"||focusId==="buttonCheck"){document.getElementById(document.getElementsByClassName('ui-draggable')[0].id).focus();}}}}
function highlightTargets(srcId){clearSelection();dragSelected=true;dragSelectedId=srcId;$('#'+srcId).removeClass('dragOff dragFocused').addClass('dragMove');$('#'+srcId).attr('aria-grabbed','true');$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').removeAttr('tabindex');$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').removeProp('tabindex');$('#dragReserves,#dragProduction,#dragConsumption').removeAttr('tabindex');$('#dragReserves,#dragProduction,#dragConsumption').removeProp('tabindex');if(document.getElementById('dragHolder3').children.length===0){$('#dragHolder3').removeClass('targetClear').addClass('targetHighlight');$('#dragHolder3').attr('onclick','targetClicked(this)');$('#dragHolder3').attr('tabindex','0');if(isKeyboard===true){$('#dragHolder3').focus();}}
if(document.getElementById('dragHolder2').children.length===0){$('#dragHolder2').removeClass('targetClear').addClass('targetHighlight');$('#dragHolder2').attr('onclick','targetClicked(this)');$('#dragHolder2').attr('tabindex','0');if(isKeyboard===true){$('#dragHolder2').focus();}}
if(document.getElementById('dragHolder1').children.length===0){$('#dragHolder1').removeClass('targetClear').addClass('targetHighlight');$('#dragHolder1').attr('onclick','targetClicked(this)');$('#dragHolder1').attr('tabindex','0');if(isKeyboard===true){$('#dragHolder1').focus();}}
if(document.getElementById('equationBottom').children.length===0){$('#equationBottom').removeClass('targetClear').addClass('targetHighlight');$('#equationBottom').attr('onclick','targetClicked(this)');$('#equationBottom').attr('tabindex','0');if(isKeyboard===true){$('#equationBottom').focus();}}
if(document.getElementById('equationTop').children.length===0){$('#equationTop').removeClass('targetClear').addClass('targetHighlight');$('#equationTop').attr('onclick','targetClicked(this)');$('#equationTop').attr('tabindex','0');if(isKeyboard===true){$('#equationTop').focus();}}
document.getElementById('in5').setAttribute("role","alert");setTimeout(function(){document.getElementById('in5').removeAttribute("role");},3000);}
function clearSelection(){dragSelected=false;$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').removeClass('targetHighlight').addClass('targetClear');$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').attr('onclick',null);$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').prop('onclick',null);$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').removeAttr('tabindex');$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').removeProp('tabindex');$('#dragReserves,#dragProduction,#dragConsumption').attr('tabindex','0');$('#dragReserves,#dragProduction,#dragConsumption').removeClass('dragMove dragFocused').addClass('dragOff');$('#dragReserves,#dragProduction,#dragConsumption').attr('aria-grabbed','false');}
function clearFocus(){$('#equationTop,#equationBottom,#dragHolder1,#dragHolder2,#dragHolder3').blur();$('#dragReserves,#dragProduction,#dragConsumption').blur();}
function checkEq(){clearSelection();if(document.getElementById('equationTop').children.length===1&&document.getElementById('equationBottom').children.length===1){if(document.getElementById('equationTop').children[0].id==='dragReserves'&&document.getElementById('equationBottom').children[0].id==='dragProduction'){document.getElementById('feedbackContainer').innerHTML='Correct. Remember this relationship.';}else if(document.getElementById('equationTop').children[0].id==='dragReserves'&&document.getElementById('equationBottom').children[0].id==='dragConsumption'){document.getElementById('feedbackContainer').innerHTML='Incorrect. If a country was consuming exactly the same amount of a fuel that it produced each year, this equation would be correct; however, that is not often the case.';}else if(document.getElementById('equationTop').children[0].id==='dragProduction'&&document.getElementById('equationBottom').children[0].id==='dragReserves'){document.getElementById('feedbackContainer').innerHTML='Incorrect. Check to see if you have the positions of your variables switched.';}else if(document.getElementById('equationTop').children[0].id==='dragProduction'&&document.getElementById('equationBottom').children[0].id==='dragConsumption'){document.getElementById('feedbackContainer').innerHTML='Incorrect. Does this equation relate to a country’s fuel <i>reserves</i>?';}else if(document.getElementById('equationTop').children[0].id==='dragConsumption'&&document.getElementById('equationBottom').children[0].id==='dragReserves'){document.getElementById('feedbackContainer').innerHTML='Incorrect. Consider whether the amount of a fuel a country consumes (versus that which it produces) is an appropriate indicator of how long the country’s reserves will last.';}else if(document.getElementById('equationTop').children[0].id==='dragConsumption'&&document.getElementById('equationBottom').children[0].id==='dragProduction'){document.getElementById('feedbackContainer').innerHTML='Incorrect. Does this equation relate to a country’s fuel <i>reserves</i>?';}else{document.getElementById('feedbackContainer').innerHTML='Drag an item to both the numerator and the denominator.';}}else{document.getElementById('feedbackContainer').innerHTML='Drag an item to both the numerator and the denominator.';}
document.getElementById('feedbackContainer').setAttribute("role","alert");setTimeout(function(){document.getElementById('feedbackContainer').removeAttribute("role");},3000);onWindowResize();}
function onWindowResize(){pso.request(window.opener,'setheight',$("body").outerHeight(true));}
initDrag();window.addEventListener('keydown',keyDownGlobal,false);window.addEventListener("resize",onWindowResize,false);onWindowResize();
